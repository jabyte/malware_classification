using FileIO
using ImageMagick
using QuartzImageIO

function file_to_image( input_dir, file, output_dir )
    try
        cd( input_dir )
        file_strim = open( file, "r" )
        file_size = stat( file ).size

        if file_size > 0
            file_width = trunc( Int, sqrt( file_size ) )
            remainder = file_size % file_width
            array_size = file_width * file_width
            file_array = read( file_strim )
            close( file_strim )
            file_array = file_array[1:array_size]

            file_array = reshape( file_array, ( file_width, file_width ) )
            file_array = rotr90( file_array )
            save( output_dir * file * ".png", file_array )
        end
    catch err
        showerror(STDOUT, err, backtrace() )
    end
end

print("Where are the files located: ")
input_dir = readline()
println()

print("Where do you want to keep the ouptup images: ")
output_dir = readline()

try
    println("Converting files to image...")
    for file in readdir( input_dir )
        file_to_image( input_dir, file, output_dir )
    end
    println("Done Successfully!\nThe new image files are kept in " * output_dir * ".\n")
catch err
    #showerror(STDOUT, err, backtrace() )
    println("\nOops! Things went side ways. Check your inputs and retry.")
end
